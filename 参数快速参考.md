# Rule-GNN é…ç½®å‚æ•°å¿«é€Ÿå‚è€ƒ

## ğŸ“‹ å‚æ•°é€ŸæŸ¥è¡¨

### ğŸ¯ æŒ‰è®­ç»ƒé˜¶æ®µåˆ†ç±»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å…±äº«å‚æ•°ï¼ˆæ‰€æœ‰é˜¶æ®µï¼‰                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ dataset, data_path, rule_file, save_path                    â”‚
â”‚ cuda, cpu_num, seed, hidden_dim, p_norm                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é˜¶æ®µ 1: RulE é¢„è®­ç»ƒ (RotatE + è§„åˆ™åµŒå…¥)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… æ¥è‡ªåŸå§‹ RulE çš„å‚æ•°                                      â”‚
â”‚                                                             â”‚
â”‚ [æ‰¹æ¬¡å‚æ•°]                                                   â”‚
â”‚ â€¢ batch_size (256)                                          â”‚
â”‚ â€¢ negative_sample_size (512)                                â”‚
â”‚ â€¢ rule_batch_size (256)                                     â”‚
â”‚ â€¢ rule_negative_size (128)                                  â”‚
â”‚                                                             â”‚
â”‚ [æŸå¤±å‡½æ•°]                                                   â”‚
â”‚ â€¢ gamma_fact (6)                                            â”‚
â”‚ â€¢ gamma_rule (8)                                            â”‚
â”‚ â€¢ weight_rule (1)                                           â”‚
â”‚ â€¢ regularization (0)                                        â”‚
â”‚                                                             â”‚
â”‚ [è´Ÿé‡‡æ ·ç­–ç•¥]                                                 â”‚
â”‚ â€¢ negative_adversarial_sampling (true)                      â”‚
â”‚ â€¢ adversarial_temperature (0.25)                            â”‚
â”‚ â€¢ uni_weight (false)                                        â”‚
â”‚ â€¢ disable_adv (false)                                       â”‚
â”‚                                                             â”‚
â”‚ [ä¼˜åŒ–å™¨]                                                     â”‚
â”‚ â€¢ learning_rate (0.0001)                                    â”‚
â”‚ â€¢ warm_up_steps (null = max_steps/2)                        â”‚
â”‚ â€¢ max_steps (30000)                                         â”‚
â”‚                                                             â”‚
â”‚ [æ—¥å¿—]                                                       â”‚
â”‚ â€¢ save_checkpoint_steps (10)                                â”‚
â”‚ â€¢ valid_steps (1000)                                        â”‚
â”‚ â€¢ log_steps (100)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é˜¶æ®µ 2: å¯¼å‡ºåµŒå…¥ï¼ˆè‡ªåŠ¨ï¼‰                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           é˜¶æ®µ 3: Rule-GNN è®­ç»ƒï¼ˆGNN æ›¿ä»£ Groundingï¼‰       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ†• Rule-GNN å‚æ•°                                            â”‚
â”‚                                                             â”‚
â”‚ [è®­ç»ƒå‚æ•°]                                                  â”‚
â”‚ â€¢ smoothing (0.2)                                           â”‚
â”‚ â€¢ batch_per_epoch (1000000)                                 â”‚
â”‚ â€¢ print_every (10)                                          â”‚
â”‚ â€¢ g_batch_size (16)                                         â”‚
â”‚ â€¢ g_lr (0.0001)                                             â”‚
â”‚ â€¢ dropout (0.1)                                             â”‚
â”‚ â€¢ rule_gnn_num_iters (50)                                   â”‚
â”‚ â€¢ rule_gnn_valid_every (5)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” å‚æ•°æ¥æºæ ‡è®°

| æ ‡è®° | è¯´æ˜ |
|-----|------|
| âœ… | æ¥è‡ªåŸå§‹ RulE é¢„è®­ç»ƒé˜¶æ®µ (`main.py` PreTrainer) |
| ğŸ†• | Rule-GNN æ–°å¢å‚æ•° |

æ³¨æ„ï¼šRule-GNN **ä¸ä½¿ç”¨** RulE çš„ Grounding é˜¶æ®µå‚æ•°ï¼ˆå¦‚ mlp_rule_dim, alpha ç­‰ï¼‰

## ğŸ“Š é‡è¦å‚æ•°é€ŸæŸ¥

### å½±å“è®­ç»ƒæ—¶é—´çš„å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | å‡å°‘æ—¶é—´ | æé«˜è´¨é‡ |
|-----|--------|---------|---------|
| `max_steps` | 30000 | â†’ 5000 | â†’ 50000 |
| `rule_gnn_num_iters` | 50 | â†’ 10 | â†’ 100 |
| `valid_steps` | 1000 | â†’ 2000 | â†’ 500 |

### å½±å“å†…å­˜å ç”¨çš„å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | å‡å°‘å†…å­˜ |
|-----|--------|----------|
| `batch_size` | 256 | â†’ 128 |
| `negative_sample_size` | 512 | â†’ 256 |
| `g_batch_size` | 16 | â†’ 8 |
| `hidden_dim` | 2000 | â†’ 1000 |

### å½±å“æ¨¡å‹æ€§èƒ½çš„å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | ä½œç”¨ |
|-----|--------|------|
| `hidden_dim` | 2000 | åµŒå…¥ç»´åº¦ï¼Œè¶Šå¤§è¡¨è¾¾èƒ½åŠ›è¶Šå¼º |
| `dropout` | 0.1 | æ­£åˆ™åŒ–ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ |
| `smoothing` | 0.2 | æ ‡ç­¾å¹³æ»‘ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ |
| `weight_rule` | 1 | è§„åˆ™æŸå¤±æƒé‡ |
| `gamma_fact` | 6 | ä¸‰å…ƒç»„ margin |
| `gamma_rule` | 8 | è§„åˆ™ margin |

## ğŸ¯ ä¸åŒæ•°æ®é›†çš„æ¨èé…ç½®

### UMLSï¼ˆå°æ•°æ®é›†ï¼‰

```json
{
    "hidden_dim": 2000,
    "max_steps": 30000,
    "batch_size": 256,
    "smoothing": 0.2
}
```

### FB15k-237ï¼ˆä¸­ç­‰æ•°æ®é›†ï¼‰

```json
{
    "hidden_dim": 1000,
    "max_steps": 50000,
    "batch_size": 256,
    "smoothing": 0.5
}
```

### WN18RRï¼ˆä¸­ç­‰æ•°æ®é›†ï¼‰

```json
{
    "hidden_dim": 500,
    "max_steps": 40000,
    "batch_size": 256,
    "smoothing": 0.3
}
```

## ğŸ”§ å¸¸è§è°ƒä¼˜åœºæ™¯

### åœºæ™¯ 1: GPU å†…å­˜ä¸è¶³

```json
{
    "batch_size": 128,              // åŸ 256
    "negative_sample_size": 256,    // åŸ 512
    "g_batch_size": 8,              // åŸ 16
    "hidden_dim": 1000              // åŸ 2000
}
```

### åœºæ™¯ 2: å¿«é€ŸéªŒè¯ä»£ç 

```json
{
    "max_steps": 1000,
    "rule_gnn_num_iters": 5,
    "valid_steps": 100
}
```

### åœºæ™¯ 3: è¿½æ±‚æœ€ä½³æ€§èƒ½

```json
{
    "max_steps": 50000,
    "rule_gnn_num_iters": 100,
    "dropout": 0.15,
    "smoothing": 0.3
}
```

### åœºæ™¯ 4: åªè®­ç»ƒ Rule-GNN

```bash
# å‘½ä»¤è¡Œ
python main_rule_gnn.py --init ../config/umls_rule_gnn_config.json --skip_pretrain
```

```json
{
    // åªéœ€å…³æ³¨è¿™äº›å‚æ•°
    "dropout": 0.2,
    "rule_gnn_num_iters": 100,
    "rule_gnn_valid_every": 5
}
```

## ğŸ“ å‚æ•°ä¿®æ”¹æ£€æŸ¥æ¸…å•

ä¿®æ”¹é…ç½®å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] `hidden_dim` åœ¨æ‰€æœ‰é˜¶æ®µä¿æŒä¸€è‡´
- [ ] `data_path` å’Œ `rule_file` è·¯å¾„æ­£ç¡®
- [ ] GPU å†…å­˜è¶³å¤Ÿï¼ˆæ£€æŸ¥ `batch_size` å’Œ `hidden_dim`ï¼‰
- [ ] `max_steps` è¶³å¤Ÿæ”¶æ•›ï¼ˆæŸ¥çœ‹éªŒè¯æ›²çº¿ï¼‰
- [ ] `save_path` ä¸ä¼šè¦†ç›–å·²æœ‰ç»“æœ

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. **ä½¿ç”¨é»˜è®¤é…ç½®**ï¼ˆæ¨èï¼‰ï¼š
   ```bash
   python main_rule_gnn.py --init ../config/umls_rule_gnn_config.json
   ```

2. **å¿«é€Ÿæµ‹è¯•**ï¼ˆä¿®æ”¹é…ç½®ï¼‰ï¼š
   ```bash
   # ç¼–è¾‘ config/umls_rule_gnn_config.json
   # ä¿®æ”¹ max_steps: 1000, rule_gnn_num_iters: 5
   python main_rule_gnn.py --init ../config/umls_rule_gnn_config.json
   ```

3. **åªè®­ç»ƒ Rule-GNN**ï¼š
   ```bash
   python main_rule_gnn.py --init ../config/umls_rule_gnn_config.json --skip_pretrain
   ```

---

**æç¤º**: å®Œæ•´å‚æ•°è¯´æ˜è§ `é…ç½®æ–‡ä»¶å‚æ•°è¯´æ˜.md`
