# Rule-GNN é…ç½®å‚æ•°å¿«é€Ÿå‚è€ƒ

## ğŸ“‹ å®Œæ•´å‚æ•°è¯´æ˜

### ğŸ“ æ•°æ®å’Œè·¯å¾„

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | å¿…éœ€ |
|------|--------|------|------|
| `dataset` | "umls" | æ•°æ®é›†åç§°ï¼Œä»…ç”¨äºæ—¥å¿—å’Œç»“æœè®°å½• | å¦ |
| `data_path` | "../data/umls" | æ•°æ®é›†ç›®å½•ï¼ŒåŒ…å« entities.dict, relations.dict, train.txt ç­‰ | æ˜¯ |
| `rule_file` | "../data/umls/mined_rules.txt" | æŒ–æ˜çš„é€»è¾‘è§„åˆ™æ–‡ä»¶è·¯å¾„ | æ˜¯ |
| `save_path` | "umls" | æ¨¡å‹å’Œæ—¥å¿—è¾“å‡ºç›®å½•ï¼ˆç›¸å¯¹äº src/ ç›®å½•ï¼‰ | æ˜¯ |

---

### âš™ï¸ è®¾å¤‡å’Œç¯å¢ƒ

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | å¿…éœ€ |
|------|--------|------|------|
| `cuda` | true | æ˜¯å¦ä½¿ç”¨ GPU è®­ç»ƒ | å¦ |
| `cpu_num` | 10 | æ•°æ®åŠ è½½çš„ CPU çº¿ç¨‹æ•° | å¦ |
| `seed` | 800 | éšæœºç§å­ï¼Œä¿è¯ç»“æœå¯å¤ç° | å¦ |

---

### ğŸ§  æ¨¡å‹ç»“æ„

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | å½±å“ |
|------|--------|------|------|
| `hidden_dim` | 2000 | åµŒå…¥ç»´åº¦ï¼ˆå®ä½“ã€å…³ç³»ã€è§„åˆ™çš„å‘é‡ç»´åº¦ï¼‰ | âš ï¸ å¿…é¡»åœ¨æ‰€æœ‰é˜¶æ®µä¿æŒä¸€è‡´ |
| `p_norm` | 2 | RotatE çš„è·ç¦»åº¦é‡èŒƒæ•°ï¼ˆ1 æˆ– 2ï¼‰ | RulE é¢„è®­ç»ƒ |
| `dropout` | 0.1 | Rule-GNN çš„ Dropout ç‡ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ | Rule-GNN |
| `mlp_rule_dim` | 100 | RulE Grounding é˜¶æ®µçš„ MLP ç»´åº¦ï¼ˆRule-GNN ä¸ä½¿ç”¨ï¼‰ | RulE Grounding |

**æ³¨æ„**ï¼š
- `hidden_dim` è¶Šå¤§ï¼Œæ¨¡å‹è¡¨è¾¾èƒ½åŠ›è¶Šå¼ºï¼Œä½†å†…å­˜å ç”¨ä¹Ÿè¶Šå¤§
- å°æ•°æ®é›†ï¼ˆå¦‚ UMLSï¼‰æ¨è 1000-2000ï¼Œå¤§æ•°æ®é›†æ¨è 500-1000

---

### ğŸ”„ RulE é¢„è®­ç»ƒé˜¶æ®µ

#### æ‰¹æ¬¡å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | å†…å­˜å½±å“ |
|------|--------|------|---------|
| `batch_size` | 256 | ä¸‰å…ƒç»„æ‰¹å¤§å° | ä¸­ |
| `negative_sample_size` | 512 | æ¯ä¸ªæ­£æ ·æœ¬å¯¹åº”çš„è´Ÿæ ·æœ¬æ•° | é«˜ |
| `rule_batch_size` | 256 | è§„åˆ™æ‰¹å¤§å° | ä½ |
| `rule_negative_size` | 128 | æ¯æ¡è§„åˆ™å¯¹åº”çš„è´Ÿæ ·æœ¬æ•° | ä¸­ |

**å†…å­˜è®¡ç®—**ï¼š
- æ¯æ‰¹ä¸‰å…ƒç»„å®é™…æ ·æœ¬æ•°ï¼š`batch_size Ã— (1 + negative_sample_size)` = 256 Ã— 513 = 131,328
- æ¯æ‰¹è§„åˆ™å®é™…æ ·æœ¬æ•°ï¼š`rule_batch_size Ã— (1 + rule_negative_size)` = 256 Ã— 129 = 33,024

#### æŸå¤±å‡½æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `gamma_fact` | 6 | ä¸‰å…ƒç»„æŸå¤±çš„ marginï¼Œè¶Šå¤§è¶Šä¸¥æ ¼ |
| `gamma_rule` | 8 | è§„åˆ™æŸå¤±çš„ marginï¼Œè¶Šå¤§è¶Šä¸¥æ ¼ |
| `weight_rule` | 1 | è§„åˆ™æŸå¤±çš„æƒé‡ï¼Œè°ƒèŠ‚è§„åˆ™ä¸ä¸‰å…ƒç»„æŸå¤±çš„å¹³è¡¡ |
| `regularization` | 0 | L2 æ­£åˆ™åŒ–ç³»æ•° |
| `weight_decay` | 0 | ä¼˜åŒ–å™¨çš„æƒé‡è¡°å‡ç³»æ•° |

**è°ƒä¼˜å»ºè®®**ï¼š
- `weight_rule` å¢å¤§ â†’ æ›´é‡è§†è§„åˆ™å­¦ä¹ 
- `gamma_fact/gamma_rule` å¢å¤§ â†’ æ›´ä¸¥æ ¼çš„çº¦æŸ

#### è´Ÿé‡‡æ ·ç­–ç•¥

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `negative_adversarial_sampling` | true | æ˜¯å¦ä½¿ç”¨å¯¹æŠ—æ€§è´Ÿé‡‡æ ·ï¼ˆéš¾è´Ÿæ ·æœ¬ï¼‰ |
| `adversarial_temperature` | 0.25 | å¯¹æŠ—æ€§é‡‡æ ·æ¸©åº¦ï¼Œè¶Šå°è¶Šéš¾ |
| `uni_weight` | false | æ˜¯å¦ä½¿ç”¨ç»Ÿä¸€æƒé‡ï¼ˆfalse åˆ™ä½¿ç”¨ word2vec é£æ ¼çš„å­é‡‡æ ·æƒé‡ï¼‰ |
| `disable_adv` | false | æ˜¯å¦åœ¨ warm-up åç¦ç”¨å¯¹æŠ—æ€§é‡‡æ · |

**å¯¹æŠ—æ€§è´Ÿé‡‡æ ·**ï¼šæ ¹æ®å½“å‰æ¨¡å‹çš„å¾—åˆ†ï¼Œé‡‡æ ·æ›´éš¾åŒºåˆ†çš„è´Ÿæ ·æœ¬ï¼ŒåŠ é€Ÿè®­ç»ƒã€‚

#### ä¼˜åŒ–å™¨å’Œè®­ç»ƒ

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `learning_rate` | 0.0001 | å­¦ä¹ ç‡ |
| `warm_up_steps` | null | å­¦ä¹ ç‡é¢„çƒ­æ­¥æ•°ï¼ˆnull åˆ™ä¸º max_steps/2ï¼‰ |
| `max_steps` | 30000 | RulE é¢„è®­ç»ƒçš„æœ€å¤§æ­¥æ•° |

**å­¦ä¹ ç‡è°ƒåº¦**ï¼š
- å‰ `warm_up_steps` æ­¥ï¼šå­¦ä¹ ç‡çº¿æ€§å¢é•¿åˆ° `learning_rate`
- åç»­ï¼šå­¦ä¹ ç‡é™ä½ 10 å€

#### æ—¥å¿—å’ŒéªŒè¯

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `save_checkpoint_steps` | 10 | æ¯ N æ­¥ä¿å­˜ä¸€æ¬¡ checkpoint |
| `valid_steps` | 1000 | æ¯ N æ­¥åœ¨éªŒè¯é›†ä¸Šè¯„ä¼° |
| `log_steps` | 100 | æ¯ N æ­¥æ‰“å°è®­ç»ƒæ—¥å¿— |

---

### ğŸŒ Rule-GNN è®­ç»ƒé˜¶æ®µ

#### æ‰¹æ¬¡å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `g_batch_size` | 16 | TrainDataset çš„å†…éƒ¨åˆ†ç»„å¤§å° |
| `batch_per_epoch` | 1000000 | æ¯ä¸ª epoch æœ€å¤šå¤„ç†çš„æ‰¹æ¬¡æ•°ï¼ˆ1000000 ç›¸å½“äºä¸é™åˆ¶ï¼‰ |

**æ³¨æ„**ï¼š
- `g_batch_size` ä¼ ç»™ `TrainDataset`ï¼Œå®ƒåœ¨å†…éƒ¨æŒ‰å…³ç³»å’Œæ‰¹å¤§å°åˆ†ç»„
- UMLS å®é™…æœ‰ ~282 ä¸ª batchï¼Œæ‰€ä»¥ `batch_per_epoch=1000000` ä¸ä¼šé™åˆ¶

#### è®­ç»ƒå‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `g_lr` | 0.0001 | Rule-GNN çš„å­¦ä¹ ç‡ |
| `smoothing` | 0.2 | æ ‡ç­¾å¹³æ»‘ç³»æ•°ï¼ˆ0.2 è¡¨ç¤º 20% å¹³æ»‘ï¼‰ |
| `rule_gnn_num_iters` | 50 | Rule-GNN è®­ç»ƒçš„ epoch æ•° |
| `rule_gnn_valid_every` | 5 | æ¯ N ä¸ª epoch åœ¨éªŒè¯é›†ä¸Šè¯„ä¼° |
| `print_every` | 10 | æ¯ N ä¸ª batch æ‰“å°è®­ç»ƒæŸå¤± |

**æ ‡ç­¾å¹³æ»‘**ï¼š
- åŸæ ‡ç­¾ï¼š`target = [0, 0, 0, 1, 0, ...]`ï¼ˆæ­£ç¡®ç­”æ¡ˆä¸º 1ï¼‰
- å¹³æ»‘åï¼š`target = [0.02, 0.02, 0.02, 0.8, 0.02, ...]`ï¼ˆé˜²æ­¢è¿‡æ‹Ÿåˆï¼‰

---

### ğŸ¯ å…¶ä»–å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | ç”¨åœ¨å“ª |
|------|--------|------|--------|
| `alpha` | 2.0 | KGE å¾—åˆ†æƒé‡ï¼ˆç”¨äºç»„åˆ KGE + è§„åˆ™æ¨ç†ï¼‰ | RulE Groundingï¼ˆRule-GNN ä¸ä½¿ç”¨ï¼‰ |

---

## ğŸ¯ æŒ‰è®­ç»ƒé˜¶æ®µåˆ†ç±»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å…±äº«å‚æ•°ï¼ˆæ‰€æœ‰é˜¶æ®µï¼‰                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ dataset, data_path, rule_file, save_path                    â”‚
â”‚ cuda, cpu_num, seed, hidden_dim, p_norm                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é˜¶æ®µ 1: RulE é¢„è®­ç»ƒ (RotatE + è§„åˆ™åµŒå…¥)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… æ¥è‡ªåŸå§‹ RulE çš„å‚æ•°                                      â”‚
â”‚                                                             â”‚
â”‚ [æ‰¹æ¬¡å‚æ•°]                                                   â”‚
â”‚ â€¢ batch_size (256)                                          â”‚
â”‚ â€¢ negative_sample_size (512)                                â”‚
â”‚ â€¢ rule_batch_size (256)                                     â”‚
â”‚ â€¢ rule_negative_size (128)                                  â”‚
â”‚                                                             â”‚
â”‚ [æŸå¤±å‡½æ•°]                                                   â”‚
â”‚ â€¢ gamma_fact (6)                                            â”‚
â”‚ â€¢ gamma_rule (8)                                            â”‚
â”‚ â€¢ weight_rule (1)                                           â”‚
â”‚ â€¢ regularization (0)                                        â”‚
â”‚ â€¢ weight_decay (0)                                          â”‚
â”‚                                                             â”‚
â”‚ [è´Ÿé‡‡æ ·ç­–ç•¥]                                                 â”‚
â”‚ â€¢ negative_adversarial_sampling (true)                      â”‚
â”‚ â€¢ adversarial_temperature (0.25)                            â”‚
â”‚ â€¢ uni_weight (false)                                        â”‚
â”‚ â€¢ disable_adv (false)                                       â”‚
â”‚                                                             â”‚
â”‚ [ä¼˜åŒ–å™¨]                                                     â”‚
â”‚ â€¢ learning_rate (0.0001)                                    â”‚
â”‚ â€¢ warm_up_steps (null = max_steps/2)                        â”‚
â”‚ â€¢ max_steps (30000)                                         â”‚
â”‚                                                             â”‚
â”‚ [æ—¥å¿—]                                                       â”‚
â”‚ â€¢ save_checkpoint_steps (10)                                â”‚
â”‚ â€¢ valid_steps (1000)                                        â”‚
â”‚ â€¢ log_steps (100)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é˜¶æ®µ 2: å¯¼å‡ºåµŒå…¥ï¼ˆè‡ªåŠ¨ï¼‰                       â”‚
â”‚   entity_embedding, relation_embedding, rule_emb           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           é˜¶æ®µ 3: Rule-GNN è®­ç»ƒï¼ˆGNN æ›¿ä»£ Groundingï¼‰       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ†• Rule-GNN å‚æ•°                                            â”‚
â”‚                                                             â”‚
â”‚ [è®­ç»ƒå‚æ•°]                                                  â”‚
â”‚ â€¢ g_batch_size (16)                                         â”‚
â”‚ â€¢ g_lr (0.0001)                                             â”‚
â”‚ â€¢ dropout (0.1)                                             â”‚
â”‚ â€¢ smoothing (0.2)                                           â”‚
â”‚ â€¢ batch_per_epoch (1000000)                                 â”‚
â”‚ â€¢ rule_gnn_num_iters (50)                                   â”‚
â”‚ â€¢ rule_gnn_valid_every (5)                                  â”‚
â”‚ â€¢ print_every (10)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” å‚æ•°æ¥æºæ ‡è®°

| æ ‡è®° | è¯´æ˜ |
|-----|------|
| âœ… | æ¥è‡ªåŸå§‹ RulE é¢„è®­ç»ƒé˜¶æ®µ (`main.py` PreTrainer) |
| ğŸ†• | Rule-GNN æ–°å¢å‚æ•° |

**æ³¨æ„**ï¼šRule-GNN **ä¸ä½¿ç”¨** RulE çš„ Grounding é˜¶æ®µå‚æ•°ï¼ˆå¦‚ `mlp_rule_dim`, `alpha` ç­‰ï¼‰

---

## ğŸ“Š é‡è¦å‚æ•°é€ŸæŸ¥

### å½±å“è®­ç»ƒæ—¶é—´çš„å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | å‡å°‘æ—¶é—´ | æé«˜è´¨é‡ |
|-----|--------|---------|---------|
| `max_steps` | 30000 | â†’ 5000 | â†’ 50000 |
| `rule_gnn_num_iters` | 50 | â†’ 10 | â†’ 100 |
| `valid_steps` | 1000 | â†’ 2000 | â†’ 500 |
| `batch_per_epoch` | 1000000 | â†’ 100ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰ | ä¿æŒé»˜è®¤ |

### å½±å“å†…å­˜å ç”¨çš„å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | å‡å°‘å†…å­˜ | è¯´æ˜ |
|-----|--------|----------|------|
| `hidden_dim` | 2000 | â†’ 500 æˆ– 1000 | âš ï¸ å½±å“æœ€å¤§ |
| `batch_size` | 256 | â†’ 128 | RulE é¢„è®­ç»ƒ |
| `negative_sample_size` | 512 | â†’ 256 | RulE é¢„è®­ç»ƒ |
| `g_batch_size` | 16 | â†’ 8 | Rule-GNN |

**å†…å­˜ä¼˜åŒ–ä¼˜å…ˆçº§**ï¼š
1. å…ˆå‡ `hidden_dim`ï¼ˆå½±å“æœ€å¤§ï¼‰
2. å†å‡ `g_batch_size` å’Œ `batch_size`
3. æœ€åå‡ `negative_sample_size`

### å½±å“æ¨¡å‹æ€§èƒ½çš„å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | ä½œç”¨ | è°ƒä¼˜å»ºè®® |
|-----|--------|------|---------|
| `hidden_dim` | 2000 | åµŒå…¥ç»´åº¦ï¼Œè¶Šå¤§è¡¨è¾¾èƒ½åŠ›è¶Šå¼º | å°æ•°æ®é›†ç”¨å¤§å€¼ï¼Œå¤§æ•°æ®é›†ç”¨å°å€¼ |
| `dropout` | 0.1 | æ­£åˆ™åŒ–ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ | è¿‡æ‹Ÿåˆæ—¶å¢å¤§ï¼ˆ0.2-0.3ï¼‰ |
| `smoothing` | 0.2 | æ ‡ç­¾å¹³æ»‘ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ | è¿‡æ‹Ÿåˆæ—¶å¢å¤§ï¼ˆ0.3-0.5ï¼‰ |
| `weight_rule` | 1 | è§„åˆ™æŸå¤±æƒé‡ | å¢å¤§åˆ™æ›´é‡è§†è§„åˆ™å­¦ä¹  |
| `gamma_fact` | 6 | ä¸‰å…ƒç»„ margin | å¢å¤§åˆ™çº¦æŸæ›´ä¸¥æ ¼ |
| `gamma_rule` | 8 | è§„åˆ™ margin | å¢å¤§åˆ™çº¦æŸæ›´ä¸¥æ ¼ |
| `learning_rate` | 0.0001 | å­¦ä¹ ç‡ | ä¸æ”¶æ•›æ—¶å‡å°ï¼Œéœ‡è¡æ—¶å‡å° |
| `g_lr` | 0.0001 | Rule-GNN å­¦ä¹ ç‡ | åŒä¸Š |

---

## ğŸ¯ ä¸åŒæ•°æ®é›†çš„æ¨èé…ç½®

### UMLSï¼ˆå°æ•°æ®é›†ï¼Œ135 å®ä½“ï¼‰

```json
{
    "hidden_dim": 2000,
    "max_steps": 30000,
    "batch_size": 256,
    "negative_sample_size": 512,
    "smoothing": 0.2,
    "rule_gnn_num_iters": 50
}
```

### Kinshipï¼ˆå°æ•°æ®é›†ï¼Œ104 å®ä½“ï¼‰

```json
{
    "hidden_dim": 1000,
    "max_steps": 30000,
    "batch_size": 256,
    "smoothing": 0.2,
    "rule_gnn_num_iters": 50
}
```

### FB15k-237ï¼ˆä¸­ç­‰æ•°æ®é›†ï¼Œ14K å®ä½“ï¼‰

```json
{
    "hidden_dim": 500,
    "max_steps": 50000,
    "batch_size": 512,
    "negative_sample_size": 256,
    "smoothing": 0.5,
    "rule_gnn_num_iters": 50,
    "g_batch_size": 32
}
```

### WN18RRï¼ˆå¤§æ•°æ®é›†ï¼Œ40K å®ä½“ï¼‰

```json
{
    "hidden_dim": 500,
    "max_steps": 40000,
    "batch_size": 512,
    "negative_sample_size": 256,
    "smoothing": 0.3,
    "rule_gnn_num_iters": 50,
    "g_batch_size": 32
}
```

---

## ğŸ”§ å¸¸è§è°ƒä¼˜åœºæ™¯

### åœºæ™¯ 1: GPU å†…å­˜ä¸è¶³ï¼ˆCUDA out of memoryï¼‰

```json
{
    "hidden_dim": 500,              // åŸ 2000 âš ï¸ æœ€é‡è¦
    "batch_size": 128,              // åŸ 256
    "negative_sample_size": 256,    // åŸ 512
    "g_batch_size": 8               // åŸ 16
}
```

**æ­¥éª¤**ï¼š
1. å…ˆå°† `hidden_dim` å‡åŠï¼ˆ2000 â†’ 1000 æˆ– 500ï¼‰
2. å¦‚æœè¿˜ä¸å¤Ÿï¼Œå‡å° `g_batch_size`ï¼ˆ16 â†’ 8ï¼‰
3. æœ€åæ‰å‡å° RulE çš„æ‰¹æ¬¡å‚æ•°

### åœºæ™¯ 2: å¿«é€ŸéªŒè¯ä»£ç ï¼ˆå‡ åˆ†é’Ÿå†…è·‘å®Œï¼‰

```json
{
    "max_steps": 1000,              // åŸ 30000
    "rule_gnn_num_iters": 5,        // åŸ 50
    "valid_steps": 100,             // åŸ 1000
    "batch_per_epoch": 50           // åŸ 1000000
}
```

### åœºæ™¯ 3: è¿½æ±‚æœ€ä½³æ€§èƒ½

```json
{
    "hidden_dim": 2000,             // å¤§ç»´åº¦
    "max_steps": 50000,             // æ›´å¤šè®­ç»ƒæ­¥æ•°
    "rule_gnn_num_iters": 100,      // æ›´å¤š epoch
    "dropout": 0.15,                // ç¨å¾®å¢åŠ æ­£åˆ™åŒ–
    "smoothing": 0.3,               // å¢åŠ æ ‡ç­¾å¹³æ»‘
    "rule_gnn_valid_every": 3       // æ›´é¢‘ç¹éªŒè¯
}
```

### åœºæ™¯ 4: åªè®­ç»ƒ Rule-GNNï¼ˆå·²æœ‰é¢„è®­ç»ƒæ¨¡å‹ï¼‰

**å‘½ä»¤è¡Œ**ï¼š
```bash
python main_rule_gnn.py --init ../config/umls_rule_gnn_config.json --skip_pretrain
```

**é…ç½®æ–‡ä»¶**ï¼ˆåªéœ€å…³æ³¨è¿™äº›å‚æ•°ï¼‰ï¼š
```json
{
    "hidden_dim": 2000,             // å¿…é¡»ä¸é¢„è®­ç»ƒä¸€è‡´
    "dropout": 0.1,
    "smoothing": 0.2,
    "g_batch_size": 16,
    "g_lr": 0.0001,
    "rule_gnn_num_iters": 50,
    "rule_gnn_valid_every": 5
}
```

### åœºæ™¯ 5: æ¨¡å‹è¿‡æ‹Ÿåˆï¼ˆè®­ç»ƒé›†å¥½ä½†éªŒè¯é›†å·®ï¼‰

```json
{
    "dropout": 0.2,                 // åŸ 0.1ï¼Œå¢åŠ  Dropout
    "smoothing": 0.3,               // åŸ 0.2ï¼Œå¢åŠ æ ‡ç­¾å¹³æ»‘
    "weight_decay": 0.0001,         // åŸ 0ï¼Œå¢åŠ æƒé‡è¡°å‡
    "regularization": 0.01          // åŸ 0ï¼Œå¢åŠ  L2 æ­£åˆ™åŒ–
}
```

### åœºæ™¯ 6: æ¨¡å‹ä¸æ”¶æ•›ï¼ˆæŸå¤±ä¸ä¸‹é™ï¼‰

```json
{
    "learning_rate": 0.00005,       // åŸ 0.0001ï¼Œå‡å°å­¦ä¹ ç‡
    "g_lr": 0.00005,                // åŸ 0.0001
    "max_steps": 50000,             // åŸ 30000ï¼Œå¢åŠ è®­ç»ƒæ­¥æ•°
    "warm_up_steps": 5000           // å¢åŠ é¢„çƒ­æ­¥æ•°
}
```

---

## ğŸ“ å‚æ•°ä¿®æ”¹æ£€æŸ¥æ¸…å•

ä¿®æ”¹é…ç½®å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] `hidden_dim` åœ¨ RulE é¢„è®­ç»ƒå’Œ Rule-GNN é˜¶æ®µä¿æŒä¸€è‡´
- [ ] `data_path` å’Œ `rule_file` è·¯å¾„æ­£ç¡®ä¸”æ–‡ä»¶å­˜åœ¨
- [ ] GPU å†…å­˜è¶³å¤Ÿï¼ˆä¼°ç®—ï¼š`hidden_dim Ã— batch_size Ã— num_edges`ï¼‰
- [ ] `max_steps` è¶³å¤Ÿæ”¶æ•›ï¼ˆæŸ¥çœ‹éªŒè¯æ›²çº¿ï¼‰
- [ ] `save_path` ä¸ä¼šè¦†ç›–å·²æœ‰é‡è¦ç»“æœ
- [ ] ä½¿ç”¨ `--skip_pretrain` æ—¶ï¼Œç¡®ä¿ checkpoint æ–‡ä»¶å­˜åœ¨
- [ ] `seed` å›ºå®šä»¥ä¿è¯ç»“æœå¯å¤ç°

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®Œæ•´è®­ç»ƒï¼ˆæ¨èé¦–æ¬¡è¿è¡Œï¼‰

```bash
cd src
python main_rule_gnn.py --init ../config/umls_rule_gnn_config.json
```

åŒ…å«ï¼š
- RulE é¢„è®­ç»ƒï¼ˆ~30 åˆ†é’Ÿï¼ŒGPUï¼‰
- å¯¼å‡ºåµŒå…¥ï¼ˆè‡ªåŠ¨ï¼‰
- Rule-GNN è®­ç»ƒï¼ˆ~15 åˆ†é’Ÿï¼ŒGPUï¼‰

### 2. å¿«é€Ÿæµ‹è¯•ï¼ˆ5 åˆ†é’ŸéªŒè¯ä»£ç ï¼‰

å…ˆä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š
```json
{
    "max_steps": 1000,
    "rule_gnn_num_iters": 5,
    "batch_per_epoch": 50
}
```

ç„¶åè¿è¡Œï¼š
```bash
python main_rule_gnn.py --init ../config/umls_rule_gnn_config.json
```

### 3. åªè®­ç»ƒ Rule-GNNï¼ˆå·²æœ‰é¢„è®­ç»ƒæ¨¡å‹ï¼‰

```bash
python main_rule_gnn.py --init ../config/umls_rule_gnn_config.json --skip_pretrain
```

**å‰æ**ï¼š`{save_path}/checkpoint` æ–‡ä»¶å­˜åœ¨

---

## ğŸ› å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

### é”™è¯¯ 1: CUDA out of memory

**ç°è±¡**ï¼š
```
RuntimeError: CUDA out of memory. Tried to allocate XXX MiB
```

**è§£å†³**ï¼šå‚è€ƒ"åœºæ™¯ 1: GPU å†…å­˜ä¸è¶³"

### é”™è¯¯ 2: AttributeError: 'EasyDict' object has no attribute 'xxx'

**åŸå› **ï¼šé…ç½®æ–‡ä»¶ç¼ºå°‘å¿…éœ€å‚æ•°

**è§£å†³**ï¼šå¯¹æ¯” `config/umls_rule_gnn_config.json` æ£€æŸ¥æ˜¯å¦é—æ¼å‚æ•°

### é”™è¯¯ 3: dimension mismatch (ç»´åº¦ä¸åŒ¹é…)

**åŸå› **ï¼šé¢„è®­ç»ƒå’Œ Rule-GNN çš„ `hidden_dim` ä¸ä¸€è‡´

**è§£å†³**ï¼šç¡®ä¿é…ç½®æ–‡ä»¶ä¸­çš„ `hidden_dim` ä¸é¢„è®­ç»ƒ checkpoint ä¸€è‡´ï¼Œæˆ–é‡æ–°é¢„è®­ç»ƒ

### é”™è¯¯ 4: checkpoint not found

**åŸå› **ï¼šä½¿ç”¨ `--skip_pretrain` ä½†æ²¡æœ‰é¢„è®­ç»ƒæ¨¡å‹

**è§£å†³**ï¼š
- å»æ‰ `--skip_pretrain`ï¼Œå®Œæ•´è®­ç»ƒ
- æˆ–å°† `save_path` æŒ‡å‘å·²æœ‰ checkpoint çš„ç›®å½•

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **å®Œæ•´è®­ç»ƒæµç¨‹**ï¼š`Rule-GNNå®Œæ•´è®­ç»ƒæ­¥éª¤.md`
- **ä»£ç è¯¦è§£**ï¼š`Rule-GNNä»£ç è¯¦è§£.md`
- **æ ¸å¿ƒåŸç†**ï¼š`Rule-GNNæ ¸å¿ƒåŸç†è®²è§£.md`
- **åˆ›æ–°ç‚¹**ï¼š`Rule-GNNåˆ›æ–°å®ç°æ–¹æ¡ˆ.md`

---

**æœ€åæ›´æ–°**: 2024-11-20
**ç‰ˆæœ¬**: v2.0
